<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Administração - Casa Camarim</title>
<style>
body{font-family:Arial,sans-serif;background:#f5f5f5;margin:0;padding:20px;}
#loginSection,#adminSection{max-width:600px;margin:0 auto;}
input,button{width:100%;padding:10px;margin:5px 0;border-radius:5px;border:1px solid #ccc;}
button{background:#333;color:#fff;border:none;cursor:pointer;}
.card-agendamento{background:#fff;padding:10px;margin:10px 0;border-radius:5px;box-shadow:0 1px 4px rgba(0,0,0,0.1);}
.btn-cancelar{background:#d9534f;color:#fff;padding:5px 10px;border:none;border-radius:5px;cursor:pointer;}
.status-ok{color:green;font-weight:bold;}
.status-cancelado{color:red;font-weight:bold;}
#containerBtnServicos{margin-top:20px;text-align:center;}
#btnGerenciarServicos{background:#007bff;}
#modalCancelamento{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;}
.modal-content{background:#fff;padding:20px;border-radius:10px;text-align:center;max-width:400px;margin:auto;}
.modal-content button{margin:10px 5px;padding:8px 12px;}
</style>
</head>
<body>

<div id="loginSection">
    <h2>Login Administrador</h2>
    <input type="text" id="login" placeholder="Login">
    <input type="password" id="senha" placeholder="Senha">
    <button id="btnLogin">Entrar</button>
</div>

<div id="adminSection" style="display:none;">
    <h2>Agendamentos</h2>
    <button onclick="logout()">Sair</button>
    <div id="agendamentosContainer"></div>

    <!-- Botão exclusivo para Michele -->
    <div id="containerBtnServicos" style="display:none;">
        <button id="btnGerenciarServicos">Gerenciar Serviços</button>
    </div>
</div>

<!-- Modal de confirmação -->
<div id="modalCancelamento">
    <div class="modal-content">
        <p>Tem certeza que deseja cancelar este agendamento?</p>
        <button id="btnSim">Sim</button>
        <button id="btnNao">Não</button>
    </div>
</div>

<script>
// Administradores
const admins = JSON.parse(localStorage.getItem("admins") || "[]");

// Inicializa agendamentos se não existir
if(!localStorage.getItem("agendamentos")) localStorage.setItem("agendamentos", JSON.stringify([]));

let adminLogado = null;
let agendamentoParaCancelar = null;

// LOGIN
document.getElementById("btnLogin").addEventListener("click", () => {
    const login = document.getElementById("login").value.trim();
    const senha = document.getElementById("senha").value.trim();
    const user = admins.find(a => a.login === login && a.senha === senha);
    if(!user){ alert("Login ou senha incorretos!"); return; }

    adminLogado = user;
    localStorage.setItem("adminLoggedIn", JSON.stringify(adminLogado));
    loginSection.style.display = "none";
    adminSection.style.display = "block";

    configurarBotaoServicos();
    carregarAgendamentos();
});

// LOGOUT
function logout() {
    adminLogado = null;
    localStorage.removeItem("adminLoggedIn");
    loginSection.style.display = "block";
    adminSection.style.display = "none";
}

// CARREGAR AGENDAMENTOS DO LOCALSTORAGE
function carregarAgendamentos() {
    const container = document.getElementById("agendamentosContainer");
    container.innerHTML = "";
    const agendamentos = JSON.parse(localStorage.getItem("agendamentos") || "[]");

    const filtrados = agendamentos.filter(a => a.especialidade === adminLogado.especialidade);
    if(filtrados.length === 0) {
        container.innerHTML = "<p>Nenhum agendamento.</p>";
        return;
    }

    filtrados.sort((a,b)=> new Date(a.data + " " + a.horario) - new Date(b.data + " " + b.horario));

    filtrados.forEach(a => {
        const div = document.createElement("div");
        div.classList.add("card-agendamento");
        div.innerHTML = `
            <p><b>Serviço:</b> ${a.servico}</p>
            <p><b>Cliente:</b> ${a.cliente}</p>
            <p><b>Telefone:</b> ${a.telefone}</p>
            <p><b>Data:</b> ${a.data}</p>
            <p><b>Horário:</b> ${a.horario}</p>
            <p><b>Status:</b> <span class="${a.status==="AGENDADO"?"status-ok":"status-cancelado"}">${a.status}</span></p>
            ${a.status==="AGENDADO"?`<button class="btn-cancelar" data-id="${a.id}">Cancelar</button>`:""}
        `;
        container.appendChild(div);
    });

    document.querySelectorAll(".btn-cancelar").forEach(btn => {
        btn.addEventListener("click", () => abrirModalCancelamento(parseInt(btn.dataset.id)));
    });
}

// MODAL DE CANCELAMENTO
const modal = document.getElementById("modalCancelamento");
const btnSim = document.getElementById("btnSim");
const btnNao = document.getElementById("btnNao");

function abrirModalCancelamento(id) {
    agendamentoParaCancelar = id;
    modal.style.display = "flex";
}

function fecharModal() {
    modal.style.display = "none";
    agendamentoParaCancelar = null;
}

btnNao.addEventListener("click", fecharModal);

btnSim.addEventListener("click", () => {
    if(agendamentoParaCancelar !== null){
        let agendamentos = JSON.parse(localStorage.getItem("agendamentos") || "[]");
        const index = agendamentos.findIndex(a => a.id === agendamentoParaCancelar);
        if(index !== -1) {
            agendamentos[index].status = "CANCELADO";
            localStorage.setItem("agendamentos", JSON.stringify(agendamentos));
            carregarAgendamentos();
            fecharModal();
        }
    }
});

// BOTÃO EXCLUSIVO PARA MICHELI
function configurarBotaoServicos() {
    const btn = document.getElementById("btnGerenciarServicos");
    const container = document.getElementById("containerBtnServicos");
    if(adminLogado.login === "Micheli"){
        container.style.display = "block";
        btn.onclick = () => window.location.href = "gerenciarServicos.html";
    } else {
        container.style.display = "none";
    }
}

// LOGIN AUTOMÁTICO
document.addEventListener("DOMContentLoaded", () => {
    const logado = JSON.parse(localStorage.getItem("adminLoggedIn")||"null");
    if(logado){
        adminLogado = logado;
        loginSection.style.display = "none";
        adminSection.style.display = "block";
        configurarBotaoServicos();
        carregarAgendamentos();
    }

    // Atualização em tempo real a cada 2 segundos
    setInterval(() => {
        if(adminLogado) carregarAgendamentos();
    }, 2000);
});
</script>
</body>
</html>
